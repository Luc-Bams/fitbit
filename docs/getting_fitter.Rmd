---
title: "Getting fitter"
author: 
  - name: "Luc Bams"
    email: "luc-bams@hotmail.com"
    url: "https://github.com/Luc-Bams"
data: "May 9, 2019"
output:
  rmdformats::readthedown:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    highlight: espresso
    number_sections: true
---
```{r include = FALSE}
# Make sure the most recent data is loaded
source('~/R/Projects/fitbit/scripts/data_collection.R', encoding = 'UTF-8')
```

\*insert introductory section here\*  
\*make sure to come up with better titles for everything\*  

# Data
\*describe how the data were collected, stored, and what they look like\*

## Activity
What I choose to describe here as activity data are all the time-series data returned by the fitbit API through the [getActivitiesResourceByDatePeriod](https://dev.fitbit.com/build/reference/web-api/explore/#/Time_Series/getActivitiesResourceByDatePeriod) method. For this explanatory section, I'll subdivide these 11 types of activity data in the following three groups:  
+ _Basics_:  
+ _Intensity_:  
+ _Metabolism_:  


### Basics
```{r}
head(act_data$steps)
```

```{r include = FALSE}
data <- list()
for(type in c("calories", "distance", "elevation", "floors", "steps")) {
  data[[type]] <- act_data[[type]] %>% 
    select_(.dots = list("datetime", type, "day", "week")) %>%
    mutate(type = type) %>%
    rename(value = !!type) %>%
    select(datetime, type, value, day, week)
  data[[type]]$value <- as.double(data[[type]]$value)
}

act_tidy <- rbind(data$calories, data$distance, data$elevation, data$floors, data$steps)
act_tidy$day <- factor(act_tidy$day, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"), ordered = TRUE)

remove(data)
```


#### Minute-level
```{r}
act_tidy %>% 
  filter(!is.na(act_tidy$datetime)) %>%
  group_by(type) %>%
  summarise(
    total = sum(value),
    minimum = min(value),
    mean = mean(value),
    median = median(value),
    maximum = max(value)
  ) %>% 
  knitr::kable(digits = 2, caption = "Summary of activity data")
```

#### Daily-level
```{r}
act_tidy %>% 
  filter(!is.na(act_tidy$datetime)) %>%
  group_by(as.Date(datetime, tz = "Europe/Amsterdam"), type) %>%
  summarise(
    daily_total = sum(value)
  ) %>%
  group_by(type) %>%
  summarise(
    total = sum(daily_total),
    minimum = min(daily_total),
    mean = mean(daily_total),
    median = median(daily_total),
    maximum = max(daily_total)
  ) %>% 
  knitr::kable(digits = 2, caption = "Summary of activity data")
```

#### Weekly-level
```{r}
act_tidy %>% 
  filter(!is.na(act_tidy$datetime)) %>%
  group_by(week, type) %>%
  summarise(
    weekly_total = sum(value)
  ) %>%
  group_by(type) %>%
  summarise(
    total = sum(weekly_total),
    minimum = min(weekly_total),
    mean = mean(weekly_total),
    median = median(weekly_total),
    maximum = max(weekly_total)
  ) %>% 
  knitr::kable(digits = 2, caption = "Summary of activity data")
```

```{r}
act_tidy %>% 
  filter(!is.na(act_tidy$datetime)) %>%
  group_by(week, type) %>%
  summarise(
    weekly_total = sum(value)
  ) %>%
  ggplot(aes(x = week, y = weekly_total)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ type, nrow = 2, ncol = 3, scales = "free_y")
```

### Intensity

### Metabolism 

## Heart-Rate
\*describe heart-rate data here\*
```{r}
head(hr_intraday)
```

```{r}
hr_intraday %>%  
  summarise(
    minimum = min(hr),
    mean = mean(hr),
    median = median(hr),
    maximum = max(hr)
  ) %>% 
  knitr::kable(digits = 2, caption = "Summary of heart-rate data")
```

## Weight
\*describe weight data here\*
```{r}
head(weight)
```

# How does getting fitter reflect in the data?  
\*obviously do a solid attempt to answer this question here\*  

## Rest Heart Rate
```{r message=FALSE}
hr_summary %>%
  ggplot(aes(x = date, y = rest_hr)) +
  geom_point() +
  geom_smooth(se = FALSE, span = 0.275) +
  labs(title = "Rest Heart Rate over Time",
       subtitle = "*this is how you make a subtitle, Luc*",
       caption = "*this is how you make a caption, Luc*")
```

```{r}
hr_intraday %>%  
  group_by(week) %>%
  summarise(
    minimum = min(hr),
    mean = mean(hr),
    median = median(hr),
    maximum = max(hr)
  ) %>% 
  gather(key = "type", value = "value", -week) %>%
  ggplot(aes(x = week, y = value)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ type, nrow = 2, ncol = 2, scales = "free_y")
```

## Weekly heart-rate distribution  
\*show ggridges weekly heart rate distributions here\*  

## Link steps/minute to bpm  
\*idea here is that when fitter heart rate is lower for a fixed amount of steps/min than when less fit\*  